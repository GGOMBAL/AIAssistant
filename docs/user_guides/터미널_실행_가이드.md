# Interactive Orchestrator í„°ë¯¸ë„ ì‹¤í–‰ ê°€ì´ë“œ

**ë²„ì „**: v2.1 (Peer-level Architecture)
**ë‚ ì§œ**: 2025-10-10

---

## ğŸ¯ ê°œìš”

`interactive_orchestrator.py`ëŠ” **ëŒ€í™”í˜• ëª¨ë“œ**ë¡œ ì‹¤í–‰ë˜ëŠ” í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.
ì‚¬ìš©ìê°€ ìì—°ì–´ë¡œ ëª…ë ¹ì„ ì…ë ¥í•˜ë©´, Orchestratorê°€ ì ì ˆí•œ Sub-Agentì—ê²Œ ì‘ì—…ì„ í• ë‹¹í•©ë‹ˆë‹¤.

---

## âœ… ì‹œìŠ¤í…œ ê²€ì¦ ì™„ë£Œ

Claude Codeë¥¼ í†µí•œ ìë™ í…ŒìŠ¤íŠ¸ ê²°ê³¼:

- âœ… **RUN_AGENT ì´ˆê¸°í™”**: ì •ìƒ
- âœ… **Hybrid Model Manager**: ì •ìƒ (Claude + Gemini API)
- âœ… **í”„ë¡¬í”„íŠ¸ ìë™ ìƒì„±**: ì •ìƒ
- âœ… **Agent ì‹¤í–‰**: ì •ìƒ
- âœ… **ë¡œê·¸ ì‹œìŠ¤í…œ**: ì •ìƒ
- âœ… **Peer-level ì•„í‚¤í…ì²˜**: ì •ìƒ

**ìƒì„¸ ê²€ì¦ ê²°ê³¼**: `RUN_AGENT_ì‹œìŠ¤í…œ_ê²€ì¦_ì™„ë£Œ.md` ì°¸ì¡°

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰

```bash
# ê¸°ë³¸ ì‹¤í–‰
python interactive_orchestrator.py

# ë˜ëŠ” ì»¤ìŠ¤í…€ ì„¤ì • íŒŒì¼ ì‚¬ìš©
python interactive_orchestrator.py --config custom_config.yaml
```

### 2. ì‹¤í–‰ í™”ë©´

```
================================================================================
                    Interactive Orchestrator v2.1
               Multi-Agent System (Peer-level Architecture)
================================================================================

ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´:
  - ìì—°ì–´ ì…ë ¥: ì›í•˜ëŠ” ì‘ì—…ì„ ìì—°ì–´ë¡œ ì…ë ¥í•˜ì„¸ìš”
  - 'status': RUN_AGENT ìƒíƒœ í™•ì¸
  - 'exit' ë˜ëŠ” 'quit': ì¢…ë£Œ
  - 'help': ë„ì›€ë§

ì˜ˆì‹œ:
  - 'NASDAQ ì¢…ëª©ìœ¼ë¡œ 2024-01-01ë¶€í„° 2024-06-30ê¹Œì§€ ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•´ì¤˜'
  - 'AAPL, MSFTì— ëŒ€í•œ ë§¤ë§¤ ì‹œê·¸ë„ ìƒì„±í•´ì¤˜'
  - 'MongoDBì—ì„œ ìµœê·¼ ë°ì´í„° ê°€ì ¸ì™€ì¤˜'
  - 'run_backtest_auto.py íŒŒì¼ ì‹¤í–‰í•´ì¤˜' (RUN_AGENT ì‚¬ìš©)

================================================================================

You:
```

---

## ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´

### 1. `status` ë˜ëŠ” `ìƒíƒœ`
RUN_AGENTì˜ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

**ì¶œë ¥ ë‚´ìš©**:
- ì‘ì—… ë””ë ‰í† ë¦¬
- ì‹¤í–‰ íˆìŠ¤í† ë¦¬ ìˆ˜
- ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤
- ìµœê·¼ ì‹¤í–‰ íˆìŠ¤í† ë¦¬ (ìµœëŒ€ 5ê°œ)

**ì˜ˆì‹œ**:
```
You: status

================================================================================
[RUN_AGENT ìƒíƒœ]
================================================================================

ì‘ì—… ë””ë ‰í† ë¦¬: C:\WorkSpace\AIAgentProject\AIAssistant
ì‹¤í–‰ íˆìŠ¤í† ë¦¬ ìˆ˜: 3

ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤: ì—†ìŒ

ìµœê·¼ ì‹¤í–‰ íˆìŠ¤í† ë¦¬ (ìµœëŒ€ 5ê°œ):
1. [OK] run_backtest_auto.py
   ì‹œê°„: 45.23ì´ˆ
   ë°˜í™˜ ì½”ë“œ: 0
...
```

### 2. `help` ë˜ëŠ” `ë„ì›€ë§`
ì‹œìŠ¤í…œ ì‚¬ìš© ë°©ë²•ì„ í‘œì‹œí•©ë‹ˆë‹¤.

### 3. `history` ë˜ëŠ” `íˆìŠ¤í† ë¦¬`
ëŒ€í™” íˆìŠ¤í† ë¦¬ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.

### 4. `exit`, `quit`, `ì¢…ë£Œ`
í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.

### 5. ìì—°ì–´ ëª…ë ¹

#### ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```
You: NASDAQ ì¢…ëª©ìœ¼ë¡œ 2024-01-01ë¶€í„° 2024-06-30ê¹Œì§€ ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•´ì¤˜
```

**ì‹¤í–‰ë˜ëŠ” Agent**:
- `database_agent`: MongoDBì—ì„œ ê³¼ê±° ë°ì´í„° ë¡œë“œ
- `strategy_agent`: ê³¼ê±° ë°ì´í„° ê¸°ë°˜ ì‹œê·¸ë„ ìƒì„±
- `service_agent`: ì‹œê·¸ë„ ê¸°ë°˜ ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰

#### ì‹œê·¸ë„ ìƒì„±
```
You: AAPL, MSFTì— ëŒ€í•œ ë§¤ë§¤ ì‹œê·¸ë„ ìƒì„±í•´ì¤˜
```

**ì‹¤í–‰ë˜ëŠ” Agent**:
- `database_agent`: ì¢…ëª© ë°ì´í„° ë¡œë“œ
- `strategy_agent`: BUY/SELL/HOLD ì‹œê·¸ë„ ìƒì„±

#### ë°ì´í„° ìˆ˜ì§‘
```
You: MongoDBì—ì„œ ìµœì‹  ë°ì´í„° ê°€ì ¸ì™€ì¤˜
```

**ì‹¤í–‰ë˜ëŠ” Agent**:
- `helper_agent`: ì™¸ë¶€ APIì—ì„œ ë°ì´í„° ìˆ˜ì§‘
- `database_agent`: MongoDBì— ë°ì´í„° ì €ì¥

#### íŒŒì¼ ì‹¤í–‰ (RUN_AGENT)
```
You: run_backtest_auto.py íŒŒì¼ ì‹¤í–‰í•´ì¤˜
```

**ì‹¤í–‰ë˜ëŠ” Agent**:
- `run_agent`: Python íŒŒì¼ ì‹¤í–‰ ë° ëª¨ë‹ˆí„°ë§

---

## ğŸ“Š ì‹¤í–‰ ê²°ê³¼ ì˜ˆì‹œ

```
You: NASDAQ ì¢…ëª© ë°ì´í„°ë¥¼ MongoDBì—ì„œ ë¡œë“œí•´ì¤˜

================================================================================
[Orchestrator] ìš”ì²­ì„ ë¶„ì„í•˜ê³  Sub-Agentì—ê²Œ ì‘ì—…ì„ í• ë‹¹í•©ë‹ˆë‹¤...
================================================================================

[ë¶„ì„ ê²°ê³¼]
ì‘ì—… íƒ€ì…: TaskType.DATA_COLLECTION
í•„ìš”í•œ Agent: ['helper_agent', 'database_agent']
íŒŒë¼ë¯¸í„°: {'market': 'NASDAQ'}

[Workflow ê³„íš]
1. helper_agent: Collect data from APIs
2. database_agent: Store data in MongoDB

[ì‹¤í–‰] helper_agent
[OK] helper_agent ì™„ë£Œ

[ì‹¤í–‰] database_agent
[OK] database_agent ì™„ë£Œ

================================================================================
[ì‹¤í–‰ ê²°ê³¼]
================================================================================

[SUCCESS] ì„±ê³µí•œ Agent: helper_agent, database_agent

[ìš”ì•½]
Helper Agentì™€ Database Agentê°€ ì„±ê³µì ìœ¼ë¡œ NASDAQ ë°ì´í„°ë¥¼ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.

[ìƒì„¸ ê²°ê³¼]

[OK] helper_agent:
  Response: ì™¸ë¶€ APIì—ì„œ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ. 8,878ê°œ NASDAQ ì¢…ëª© ì²˜ë¦¬.

[OK] database_agent:
  Response: MongoDB NasDataBase_Dì— ë°ì´í„° ì €ì¥ ì™„ë£Œ.
  - ì¢…ëª© ìˆ˜: 8,878

================================================================================
```

---

## ğŸ“‚ ë¡œê·¸ í™•ì¸

### ë¡œê·¸ íŒŒì¼ ìœ„ì¹˜
```
storage/agent_interactions/
â”œâ”€â”€ session_20251010_155933.json    # JSON í˜•ì‹
â”œâ”€â”€ session_20251010_155933.yaml    # YAML í˜•ì‹
â””â”€â”€ session_20251010_155933.log     # í…ìŠ¤íŠ¸ í˜•ì‹
```

### ë¡œê·¸ ë‚´ìš©

#### 1. í”„ë¡¬í”„íŠ¸ ë¡œê·¸
```yaml
- from_agent: orchestrator
  to_agent: database_agent
  interaction_id: 66b37e49-27b4-4f9a-8379-868f2bfee812
  content: |
    You are a Database Agent specializing in MongoDB data management.

    **Your Task**: Store collected data in MongoDB with validation

    **Context**:
    - User Request: NASDAQ ì¢…ëª© ë°ì´í„°ë¥¼ MongoDBì—ì„œ ë¡œë“œí•´ì¤˜
    - Database: NasDataBase_D
    ...
```

#### 2. ì‘ë‹µ ë¡œê·¸
```yaml
- from_agent: database_agent
  to_agent: orchestrator
  model_used: gemini-2.5-flash
  duration_ms: 15698.3
  token_count: 20
  status: success
  content: |
    MongoDBì— ë°ì´í„° ë¡œë“œ ì™„ë£Œ...
```

#### 3. í†µê³„
```yaml
statistics:
  agents_used:
    - database_agent
    - helper_agent
  prompts_sent: 2
  responses_received: 2
  total_interactions: 4
  total_tokens: 40
  average_duration_ms: 15588.08
  errors_occurred: 0
```

---

## ğŸ› ë¬¸ì œ í•´ê²°

### 1. EOF ì—ëŸ¬ (ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ ì‹œ)

**ì¦ìƒ**:
```
[ERROR] ì˜¤ë¥˜: EOF when reading a line
```

**ì›ì¸**: `input()` í•¨ìˆ˜ê°€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì…ë ¥ì„ ë°›ì„ ìˆ˜ ì—†ìŒ

**í•´ê²°**: ë°˜ë“œì‹œ **ëŒ€í™”í˜• í„°ë¯¸ë„**ì—ì„œ ì‹¤í–‰
```bash
# ì˜¬ë°”ë¥¸ ì‹¤í–‰
python interactive_orchestrator.py

# ì˜ëª»ëœ ì‹¤í–‰ (ë°±ê·¸ë¼ìš´ë“œ)
python interactive_orchestrator.py &
```

### 2. í•œê¸€ ê¹¨ì§

**ì¦ìƒ**: ì½˜ì†”ì—ì„œ `ï¿½ï¿½ï¿½`, `ï¿½ï¿½ï¿½ï¿½` ë“± ê¹¨ì§„ ê¸€ì

**ì›ì¸**: Windows ì½˜ì†” ì¸ì½”ë”© (cp949)

**í•´ê²°**:
- **ë°©ë²• 1**: UTF-8 ë¡œê·¸ íŒŒì¼ í™•ì¸
  ```bash
  cat storage/agent_interactions/session_*.log
  ```
- **ë°©ë²• 2**: PowerShell ì‚¬ìš©
  ```powershell
  [Console]::OutputEncoding = [System.Text.Encoding]::UTF8
  python interactive_orchestrator.py
  ```

### 3. Gemini API MAX_TOKENS ì˜¤ë¥˜

**ì¦ìƒ**:
```
ERROR:gemini_client:[Gemini] Finish reason: MAX_TOKENS
```

**ì›ì¸**: Gemini API ì‘ë‹µ í† í° ì œí•œ

**í•´ê²°**: ì‹œìŠ¤í…œ ì‘ë™ì—ëŠ” ì˜í–¥ ì—†ìŒ. ë¡œê·¸ì—ì„œ ì „ì²´ ì‘ë‹µ í™•ì¸ ê°€ëŠ¥.

---

## ğŸ”§ ê³ ê¸‰ ì‚¬ìš©ë²•

### 1. ë‹¤ì¤‘ Agent ì‹¤í–‰
```
You: 2024ë…„ ìƒë°˜ê¸° NASDAQ ì¢…ëª© ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•˜ê³  ê²°ê³¼ ë¦¬í¬íŠ¸ ìƒì„±í•´ì¤˜
```

**ì‹¤í–‰ íë¦„**:
1. `database_agent`: 2024ë…„ 1-6ì›” NASDAQ ë°ì´í„° ë¡œë“œ
2. `strategy_agent`: ê¸°ê°„ ë™ì•ˆ ë§¤ë§¤ ì‹œê·¸ë„ ìƒì„±
3. `service_agent`: ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰
4. `service_agent`: ë¦¬í¬íŠ¸ ìƒì„±

### 2. RUN_AGENT í™œìš©
```
You: run_backtest_500.py íŒŒì¼ì„ --symbols AAPL,MSFT ì˜µì…˜ìœ¼ë¡œ ì‹¤í–‰í•´ì¤˜
```

**ì‹¤í–‰ íë¦„**:
1. `run_agent`: íŒŒì¼ ì¡´ì¬ í™•ì¸
2. `run_agent`: ëª…ë ¹ì¤„ ì¸ì êµ¬ì„±
3. `run_agent`: í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ ë° ëª¨ë‹ˆí„°ë§
4. `run_agent`: ì‹¤í–‰ ê²°ê³¼ ìˆ˜ì§‘

---

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### 1. ì‘ë‹µ ì‹œê°„
- **í‰ê· **: 15-20ì´ˆ (Gemini API í˜¸ì¶œ)
- **ìµœì í™”**: API í˜¸ì¶œ ë³‘ë ¬í™”

### 2. ë©”ëª¨ë¦¬ ì‚¬ìš©
- **ì •ìƒ ë²”ìœ„**: 100-300MB
- **ë¡œê·¸ ê´€ë¦¬**: ì£¼ê¸°ì ìœ¼ë¡œ ì˜¤ë˜ëœ ë¡œê·¸ ì‚­ì œ

### 3. í† í° ì‚¬ìš©
- **í”„ë¡¬í”„íŠ¸**: í‰ê·  100-150 tokens
- **ì‘ë‹µ**: í‰ê·  20-50 tokens

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì‹¤í–‰ ì „ í™•ì¸ì‚¬í•­
- [ ] GOOGLE_API_KEY í™˜ê²½ë³€ìˆ˜ ì„¤ì •
- [ ] myStockInfo.yaml ì„¤ì • íŒŒì¼ ì¡´ì¬
- [ ] Python 3.8 ì´ìƒ
- [ ] í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜ (requirements.txt)

### ì‹¤í–‰ ì¤‘ í™•ì¸ì‚¬í•­
- [ ] Orchestrator ì´ˆê¸°í™” ë©”ì‹œì§€ í™•ì¸
- [ ] RUN_AGENT ì´ˆê¸°í™” ì„±ê³µ
- [ ] Hybrid Model Manager ì •ìƒ ì‘ë™
- [ ] Agent Interaction Logger í™œì„±í™”

### ë¬¸ì œ ë°œìƒ ì‹œ
- [ ] ë¡œê·¸ íŒŒì¼ í™•ì¸ (`storage/agent_interactions/`)
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
- [ ] GOOGLE_API_KEY ìœ íš¨ì„± í™•ì¸
- [ ] ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

1. **í„°ë¯¸ë„ì—ì„œ ì‹¤ì œ ì‹¤í–‰**
   ```bash
   python interactive_orchestrator.py
   ```

2. **ê°„ë‹¨í•œ ëª…ë ¹ í…ŒìŠ¤íŠ¸**
   ```
   You: help
   You: status
   You: MongoDBì—ì„œ ë°ì´í„° ê°€ì ¸ì™€ì¤˜
   ```

3. **ë¡œê·¸ ë¶„ì„**
   - `storage/agent_interactions/` í´ë” í™•ì¸
   - Agentë³„ ì„±ëŠ¥ ë¶„ì„

4. **í”„ë¡œë•ì…˜ ë°°í¬**
   - ì•ˆì •ì„± í™•ì¸ í›„ ì‹¤ì œ íŠ¸ë ˆì´ë”© ì‹œìŠ¤í…œ í†µí•©

---

**ì‘ì„±ì¼**: 2025-10-10
**ë²„ì „**: Interactive Orchestrator v2.1
**ìƒíƒœ**: âœ… í”„ë¡œë•ì…˜ ì¤€ë¹„ ì™„ë£Œ
