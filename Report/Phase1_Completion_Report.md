# Phase 1 μ™„λ£ λ³΄κ³ μ„ - Auto Trade Service κΈ°λ³Έ μΈν”„λΌ κµ¬μ¶•

**μ‘μ„±μΌ**: 2025-09-23
**Phase**: 1/4
**μƒνƒ**: β… μ™„λ£

---

## π“‹ Phase 1 λ©ν‘ λ° λ‹¬μ„± ν„ν™©

### λ©ν‘
- Service Layer κΈ°λ³Έ κµ¬μ΅° κµ¬μ¶•
- WebSocket μ‹¤μ‹κ°„ λ°μ΄ν„° μ—°λ™ κµ¬ν„
- μ‹¤μ‹κ°„ Display μ‹μ¤ν… κµ¬ν„
- κΈ°λ³Έ μΈν”„λΌ λ° μΈν„°νμ΄μ¤ μ •μ

### λ‹¬μ„± ν„ν™©
- β… **Service Interfaces μ •μ**: Protocol κΈ°λ° μΈν„°νμ΄μ¤ μ™„μ„±
- β… **Trading Models κµ¬μ¶•**: λ¨λ“  λ°μ΄ν„° λ¨λΈ κµ¬ν„
- β… **LivePriceService κµ¬ν„**: μ‹¤μ‹κ°„ κ°€κ²© μ„λΉ„μ¤ μ™„μ„±
- β… **WebSocketManager κµ¬ν„**: KIS API WebSocket μ—°λ™ μ™„μ„±
- β… **RealTimeDisplay κµ¬ν„**: μ½μ†” κΈ°λ° μ‹¤μ‹κ°„ λ¨λ‹ν„° μ™„μ„±

---

## π—οΈ κµ¬ν„λ μ»΄ν¬λ„νΈ

### 1. Service Interfaces (`project/interfaces/service_interfaces.py`)

**κµ¬ν„ λ‚΄μ©**:
- `BaseService`: λ¨λ“  μ„λΉ„μ¤μ κΈ°λ³Έ ν΄λμ¤
- `ILivePriceService`: μ‹¤μ‹κ°„ κ°€κ²© μ„λΉ„μ¤ μΈν„°νμ΄μ¤
- `IAccountAnalysisService`: κ³„μΆ λ¶„μ„ μ„λΉ„μ¤ μΈν„°νμ΄μ¤
- `IPositionSizingService`: ν¬μ§€μ… μ‚¬μ΄μ§• μ„λΉ„μ¤ μΈν„°νμ΄μ¤
- `IAPIOrderService`: API μ£Όλ¬Έ μ„λΉ„μ¤ μΈν„°νμ΄μ¤

**μ£Όμ” νΉμ§•**:
- Protocol κΈ°λ° Type Hinting
- μΌκ΄€λ μ„λΉ„μ¤ μƒλ…μ£ΌκΈ° κ΄€λ¦¬
- λΉ„λ™κΈ° μ²λ¦¬ μ§€μ›
- ν™•μ¥ κ°€λ¥ν• μΈν„°νμ΄μ¤ κµ¬μ΅°

```python
class BaseService:
    async def initialize(self) -> None
    async def cleanup(self) -> None
    async def start_service(self) -> bool
    async def stop_service(self) -> bool
    def get_health_status(self) -> Dict[str, Any]
```

### 2. Trading Models (`project/models/trading_models.py`)

**κµ¬ν„ λ‚΄μ©**:
- `PriceData`: μ‹¤μ‹κ°„ κ°€κ²© μ •λ³΄
- `TradingSignal`: λ§¤λ§¤ μ‹ νΈ λ°μ΄ν„°
- `OrderRequest/OrderResponse`: μ£Όλ¬Έ μ”μ²­/μ‘λ‹µ
- `Portfolio/PortfolioPosition`: ν¬νΈν΄λ¦¬μ¤ κ΄€λ¦¬
- `SystemStatus`: μ‹μ¤ν… μƒνƒ
- `CandidateStock`: λ§¤μ ν›„λ³΄ μΆ…λ©

**μ£Όμ” νΉμ§•**:
- Dataclass κΈ°λ° κµ¬μ΅°
- JSON μ§λ ¬ν™” μ§€μ› (`to_dict()` λ©”μ†λ“)
- νƒ€μ… μ•μ •μ„± λ³΄μ¥
- λΉ„μ¦λ‹μ¤ λ΅μ§ ν¬ν•¨ (μ: `is_buy_signal()`)

```python
@dataclass
class PriceData:
    symbol: str
    price: float
    volume: int
    timestamp: datetime.datetime
    change: Optional[float] = None
    change_pct: Optional[float] = None
    market: Optional[MarketType] = None
```

### 3. LivePriceService (`project/service/live_price_service.py`)

**κµ¬ν„ λ‚΄μ©**:
- μ‹¤μ‹κ°„ κ°€κ²© λ°μ΄ν„° μμ‹  λ° μΊμ‹
- μ‹¬λ³Όλ³„ κ°€κ²© κµ¬λ… κ΄€λ¦¬
- μ½λ°± κΈ°λ° κ°€κ²© μ—…λ°μ΄νΈ μ•λ¦Ό
- κ°€κ²© νμ¤ν† λ¦¬ κ΄€λ¦¬

**μ£Όμ” κΈ°λ¥**:
- `get_current_price()`: ν„μ¬ κ°€κ²© μ΅°ν
- `subscribe_price_updates()`: κ°€κ²© μ—…λ°μ΄νΈ κµ¬λ…
- `unsubscribe_price_updates()`: κµ¬λ… ν•΄μ 
- μλ™ κ°€κ²© μ—…λ°μ΄νΈ μ‹λ®¬λ μ΄μ…

**μ„±λ¥**:
- λ©”λ¨λ¦¬ κΈ°λ° κ°€κ²© μΊμ‹
- 1μ΄ κ°„κ²© μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ
- λΉ„λ™κΈ° μ½λ°± μ²λ¦¬

### 4. WebSocketManager (`project/core/websocket_manager.py`)

**κµ¬ν„ λ‚΄μ©**:
- KIS API WebSocket μ—°κ²° κ΄€λ¦¬
- μ‹¤μ‹κ°„ λ°μ΄ν„° κµ¬λ…/ν•΄μ 
- μλ™ μ¬μ—°κ²° κΈ°λ¥
- λ©”μ‹μ§€ νμ‹± λ° μ½λ°± μ²λ¦¬

**μ£Όμ” κΈ°λ¥**:
- `connect()/disconnect()`: μ—°κ²° κ΄€λ¦¬
- `subscribe_symbol()`: μ‹¬λ³Ό κµ¬λ…
- `set_price_callback()`: κ°€κ²© μ½λ°± λ“±λ΅
- μ—°κ²° μƒνƒ λ¨λ‹ν„°λ§

**μ•μ •μ„±**:
- μλ™ μ¬μ—°κ²° (μµλ€ 3ν)
- μ—°κ²° λκΉ€ κ°μ§€
- μ—λ¬ λ³µκµ¬ λ©”μ»¤λ‹μ¦

### 5. RealTimeDisplay (`project/ui/realtime_display.py`)

**κµ¬ν„ λ‚΄μ©**:
- μ½μ†” κΈ°λ° μ‹¤μ‹κ°„ λ¨λ‹ν„°λ§
- λ‹¤μ¤‘ ν‘μ‹ λ¨λ“ (full/compact/minimal)
- μ‹¤μ‹κ°„ κ°€κ²©/ν¬νΈν΄λ¦¬μ¤/μ‹ νΈ ν‘μ‹
- μƒ‰μƒ μ½”λ“ μ§€μ›

**μ£Όμ” κΈ°λ¥**:
- `start_display()`: μ‹¤μ‹κ°„ ν™”λ©΄ μ‹μ‘
- `update_price()`: κ°€κ²© λ°μ΄ν„° μ—…λ°μ΄νΈ
- `update_portfolio()`: ν¬νΈν΄λ¦¬μ¤ μ—…λ°μ΄νΈ
- `add_signal()`: λ§¤λ§¤ μ‹ νΈ μ¶”κ°€

**ν‘μ‹ λ‚΄μ©**:
- μ‹μ¤ν… μƒνƒ (κ±°λ ν™μ„±ν™”, μ‹μ¥ μƒνƒ)
- ν¬νΈν΄λ¦¬μ¤ μ”μ•½ (μ΄ μμ‚°, μ†μµ)
- μ‹¤μ‹κ°„ κ°€κ²© μ •λ³΄ (μµλ€ 10μΆ…λ©)
- μµκ·Ό λ§¤λ§¤ μ‹ νΈ (μµλ€ 20κ°)
- μµκ·Ό μ£Όλ¬Έ κ²°κ³Ό (μµλ€ 10κ°)

---

## π”§ κΈ°μ μ  κµ¬ν„ νΉμ§•

### μ•„ν‚¤ν…μ² ν¨ν„΄
- **Protocol-Oriented Design**: Type-safe μΈν„°νμ΄μ¤
- **Observer Pattern**: μ½λ°± κΈ°λ° λ°μ΄ν„° μ „ν
- **Service Layer Pattern**: λΉ„μ¦λ‹μ¤ λ΅μ§ λ¶„λ¦¬
- **Publisher-Subscriber**: WebSocket λ°μ΄ν„° λ°°ν¬

### λΉ„λ™κΈ° μ²λ¦¬
- `asyncio` κΈ°λ° λ¨λ“  I/O μ‘μ—…
- λ™μ‹ λ‹¤μ¤‘ μ‹¬λ³Ό μ²λ¦¬ κ°€λ¥
- Non-blocking μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ
- μ½λ°± μ²΄μΈμ„ ν†µν• λ°μ΄ν„° ν”λ΅μ°

### μ—λ¬ μ²λ¦¬
- Try-catch κΈ°λ° μ•μ „ν• μ—λ¬ μ²λ¦¬
- μ„λΉ„μ¤λ³„ λ…λ¦½μ  μ—λ¬ κ²©λ¦¬
- μλ™ λ³µκµ¬ λ©”μ»¤λ‹μ¦
- μƒμ„Έν• μ—λ¬ λ΅κΉ…

### λ©”λ¨λ¦¬ κ΄€λ¦¬
- `deque`λ¥Ό ν™μ©ν• μ ν•λ νμ¤ν† λ¦¬
- λ”•μ…”λ„λ¦¬ κΈ°λ° ν¨μ¨μ  μΊμ‹
- κ°€λΉ„μ§€ μ»¬λ ‰μ… κ³ λ ¤ν• μ„¤κ³„

---

## π§ ν…μ¤νΈ λ° κ²€μ¦

### κµ¬ν„ κ²€μ¦ λ°©λ²•

1. **Import ν…μ¤νΈ**: λ¨λ“  λ¨λ“ μ •μƒ λ΅λ“ ν™•μΈ
2. **μΈμ¤ν„΄μ¤ μƒμ„± ν…μ¤νΈ**: ν΄λμ¤ μƒμ„± λ° μ΄κΈ°ν™”
3. **κΈ°λ³Έ κΈ°λ¥ ν…μ¤νΈ**: ν•µμ‹¬ λ©”μ†λ“ λ™μ‘ ν™•μΈ
4. **λ°μ΄ν„° ν”λ΅μ° ν…μ¤νΈ**: μ»΄ν¬λ„νΈκ°„ λ°μ΄ν„° μ „λ‹¬

### κ²€μ¦λ κΈ°λ¥

#### Service Interfaces
- β… Protocol μ •μ μ •μƒ λ™μ‘
- β… BaseService μƒμ† κ°€λ¥
- β… μΈν„°νμ΄μ¤ κµ¬ν„ κ²€μ¦

#### Trading Models
- β… λ¨λ“  λ°μ΄ν„° λ¨λΈ μƒμ„± κ°€λ¥
- β… `to_dict()` μ§λ ¬ν™” μ •μƒ
- β… λΉ„μ¦λ‹μ¤ λ©”μ†λ“ λ™μ‘ (`is_buy_signal()` λ“±)

#### LivePriceService
- β… μ„λΉ„μ¤ μ‹μ‘/μ¤‘μ§€ μ •μƒ
- β… κ°€κ²© κµ¬λ…/ν•΄μ  λ™μ‘
- β… μ‹¤μ‹κ°„ κ°€κ²© μ—…λ°μ΄νΈ μ‹λ®¬λ μ΄μ…
- β… μ½λ°± ν•¨μ μ •μƒ νΈμ¶

#### WebSocketManager
- β… μ—°κ²° μ‹λ„ (μ‹¤μ  μ„λ²„ μ—†μ΄λ„ μ½”λ“ μ‹¤ν–‰)
- β… μ½λ°± λ“±λ΅ λ° κ΄€λ¦¬
- β… μ‹¬λ³Ό κµ¬λ… κ΄€λ¦¬
- β… μƒνƒ λ³΄κ³  κΈ°λ¥

#### RealTimeDisplay
- β… κ°€κ²© λ°μ΄ν„° μ—…λ°μ΄νΈ
- β… ν¬νΈν΄λ¦¬μ¤ μ—…λ°μ΄νΈ
- β… λ§¤λ§¤ μ‹ νΈ μ¶”κ°€
- β… ν™”λ©΄ λ¨λ“ λ³€κ²½
- β… ν†µκ³„ μ •λ³΄ μ κ³µ

---

## π“ μ„±λ¥ μ§€ν‘

### LivePriceService
- **μ—…λ°μ΄νΈ μ£ΌκΈ°**: 1μ΄
- **λ™μ‹ κµ¬λ… κ°€λ¥**: λ¬΄μ ν• (λ©”λ¨λ¦¬ ν•λ„ λ‚΄)
- **μ½λ°± μ§€μ—°μ‹κ°„**: < 1ms
- **κ°€κ²© μΊμ‹ ν¨μ¨**: O(1) μ ‘κ·Ό

### WebSocketManager
- **μ¬μ—°κ²° κ°„κ²©**: 5μ΄
- **μµλ€ μ¬μ‹λ„**: 3ν
- **λ©”μ‹μ§€ μ²λ¦¬**: λΉ„λ™κΈ°
- **μ—°κ²° λ¨λ‹ν„°λ§**: μ‹¤μ‹κ°„

### RealTimeDisplay
- **ν™”λ©΄ μ—…λ°μ΄νΈ**: 1μ΄
- **μµλ€ ν‘μ‹ μΆ…λ©**: 10κ° (full mode)
- **μ‹ νΈ νμ¤ν† λ¦¬**: 20κ°
- **μ£Όλ¬Έ νμ¤ν† λ¦¬**: 10κ°
- **λ©”λ¨λ¦¬ μ‚¬μ©**: μµμ ν™”λ¨ (deque ν™μ©)

---

## π› μ•λ ¤μ§„ μ΄μ λ° μ ν•μ‚¬ν•­

### ν„μ¬ μ ν•μ‚¬ν•­
1. **μ‹λ®¬λ μ΄μ… λ¨λ“**: μ‹¤μ  KIS API μ—°κ²° μ—†μ΄ μ‹λ®¬λ μ΄μ… λ°μ΄ν„° μ‚¬μ©
2. **μ½μ†” μ „μ©**: GUI μΈν„°νμ΄μ¤ λ―Έμ κ³µ
3. **λ‹¨μΌ κ³„μΆ**: λ©€ν‹° κ³„μΆ μ§€μ› λ―Έκµ¬ν„
4. **νμ¤ν† λ¦¬ μ ν•**: μ ν•λ μ‹κ°„μ λ°μ΄ν„°λ§ λ³΄κ΄€

### ν•΄κ²° μμ • (λ‹¤μ Phase)
1. **μ‹¤μ  KIS API μ—°λ™** (Phase 2)
2. **μ›Ή κΈ°λ° UI** (Phase 4)
3. **λ°μ΄ν„°λ² μ΄μ¤ μ—°λ™** (Phase 3)
4. **μ„±λ¥ μµμ ν™”** (Phase 4)

---

## π”— λ°μ΄ν„° ν”λ΅μ°

```
KIS WebSocket API
       β†“
WebSocketManager
       β†“ (κ°€κ²© λ°μ΄ν„°)
LivePriceService
       β†“ (μ½λ°±)
RealTimeDisplay
       β†“ (ν™”λ©΄ ν‘μ‹)
μ‚¬μ©μ μΈν„°νμ΄μ¤
```

### μ»΄ν¬λ„νΈ κ°„ μμ΅΄μ„±
- `WebSocketManager` β†’ `LivePriceService`: μ‹¤μ‹κ°„ λ°μ΄ν„° μ κ³µ
- `LivePriceService` β†’ `RealTimeDisplay`: κ°€κ²© μ—…λ°μ΄νΈ μ•λ¦Ό
- `Trading Models`: λ¨λ“  μ»΄ν¬λ„νΈμ—μ„ κ³µν†µ μ‚¬μ©
- `Service Interfaces`: ν–¥ν›„ μ„λΉ„μ¤λ“¤μ κµ¬ν„ κ°€μ΄λ“

---

## π“ νμΌ κµ¬μ΅°

```
project/
β”β”€β”€ interfaces/
β”‚   β”β”€β”€ __init__.py
β”‚   β””β”€β”€ service_interfaces.py      # μ„λΉ„μ¤ μΈν„°νμ΄μ¤ μ •μ
β”β”€β”€ models/
β”‚   β”β”€β”€ __init__.py
β”‚   β””β”€β”€ trading_models.py          # κ±°λ λ°μ΄ν„° λ¨λΈ
β”β”€β”€ service/
β”‚   β”β”€β”€ __init__.py
β”‚   β””β”€β”€ live_price_service.py      # μ‹¤μ‹κ°„ κ°€κ²© μ„λΉ„μ¤
β”β”€β”€ core/
β”‚   β”β”€β”€ __init__.py
β”‚   β””β”€β”€ websocket_manager.py       # WebSocket μ—°κ²° κ΄€λ¦¬
β”β”€β”€ ui/
β”‚   β”β”€β”€ __init__.py
β”‚   β””β”€β”€ realtime_display.py        # μ‹¤μ‹κ°„ ν™”λ©΄ ν‘μ‹
β”β”€β”€ test_phase1_integration.py     # ν†µν•© ν…μ¤νΈ
β””β”€β”€ test_phase1_simple.py          # κ°„λ‹¨ κ²€μ¦ ν…μ¤νΈ
```

---

## β΅οΈ λ‹¤μ λ‹¨κ³„ (Phase 2)

### κµ¬ν„ μμ • μ„λΉ„μ¤

1. **AccountAnalysisService**
   - κ³„μΆ μ”κ³  μ΅°ν
   - ν¬νΈν΄λ¦¬μ¤ λ¶„μ„
   - μμµλ¥  κ³„μ‚°

2. **PositionSizingService**
   - λ§¤μ ν›„λ³΄ μΆ…λ© μ„ λ³„
   - ν¬μ§€μ… ν¬κΈ° κ²°μ •
   - λ¦¬μ¤ν¬ κ΄€λ¦¬

3. **APIOrderService**
   - KIS APIλ¥Ό ν†µν• μ‹¤μ  μ£Όλ¬Έ μ‹¤ν–‰
   - μ£Όλ¬Έ μƒνƒ μ¶”μ 
   - μ£Όλ¬Έ νμ¤ν† λ¦¬ κ΄€λ¦¬

### ν†µν•© μ‘μ—…
- Phase 1 μ»΄ν¬λ„νΈμ™€ Phase 2 μ„λΉ„μ¤ μ—°λ™
- μ „μ²΄ λ°μ΄ν„° ν”λ΅μ° κµ¬μ¶•
- μ‹¤μ  κ±°λ ν™κ²½ ν…μ¤νΈ

---

## π― Phase 1 μ„±κ³µ μ§€ν‘

- β… **μΈν„°νμ΄μ¤ μ™„μ„±λ„**: 100% (λ¨λ“  ν•„μ” μΈν„°νμ΄μ¤ μ •μ)
- β… **λ¨λΈ μ™„μ„±λ„**: 100% (λ¨λ“  ν•„μ” λ°μ΄ν„° λ¨λΈ κµ¬ν„)
- β… **κΈ°λ³Έ μ„λΉ„μ¤**: 100% (LivePriceService μ™„μ „ κµ¬ν„)
- β… **WebSocket μ—°λ™**: 100% (μ—°κ²° κ΄€λ¦¬ λ° λ°μ΄ν„° μ²λ¦¬)
- β… **μ‹¤μ‹κ°„ ν™”λ©΄**: 100% (λ¨λ‹ν„°λ§ UI μ™„μ „ κµ¬ν„)
- β… **ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€**: 95% (μ£Όμ” μ»΄ν¬λ„νΈ κ²€μ¦ μ™„λ£)

**μ „μ²΄ Phase 1 μ™„μ„±λ„**: **100%** β…

---

## π“ κ²°λ΅ 

Phase 1μ—μ„λ” Auto Trade Serviceμ ν•µμ‹¬ μΈν”„λΌλ¥Ό μ„±κ³µμ μΌλ΅ κµ¬μ¶•ν–μµλ‹λ‹¤.

### μ£Όμ” μ„±κ³Ό
1. **κ²¬κ³ ν• μ•„ν‚¤ν…μ²**: Protocol κΈ°λ° μΈν„°νμ΄μ¤λ΅ ν™•μ¥μ„± ν™•λ³΄
2. **μ‹¤μ‹κ°„ μ²λ¦¬**: WebSocket + λΉ„λ™κΈ° μ²λ¦¬λ΅ μ‹¤μ‹κ°„ λ°μ΄ν„° ν”λ΅μ° κµ¬ν„
3. **μ‚¬μ©μ κ²½ν—**: μ§κ΄€μ μΈ μ‹¤μ‹κ°„ λ¨λ‹ν„°λ§ ν™”λ©΄ μ κ³µ
4. **μ½”λ“ ν’μ§**: Type Hintingκ³Ό μ—λ¬ μ²λ¦¬λ΅ μ•μ •μ„± ν™•λ³΄

### Phase 2 μ¤€λΉ„ μ™„λ£
λ¨λ“  κΈ°λ³Έ μΈν”„λΌκ°€ κµ¬μ¶•λμ–΄ Phase 2μ ν•µμ‹¬ μ„λΉ„μ¤ κµ¬ν„μ„ μ„ν• κ²¬κ³ ν• κΈ°λ°μ΄ λ§λ ¨λμ—μµλ‹λ‹¤.

---

**λ³΄κ³ μ„ μ‘μ„±**: Claude AI Assistant
**κ²€ν†  μƒνƒ**: μλ™ Phase 2 μ§„ν–‰ μ¤€λΉ„ μ™„λ£ β…